# Merging SVs with SURVIVOR

## Introduction

In this long read variant pipline, we genearted SV calls from multiple callers.

This gave 80 VCF files, 20 samples $\times$ 4 callers. We then merged them with
SURVIVOR to get all SVs that were called by at least two callers in the same two
samples.

For example, consider SV_1. This was called in sample_1 by caller_1 and caller_2.
It was also called in sample_2 by caller_3, and caller_4. This SV will be kept
as a high confidence SV.

Contrast this to SV_2. This was called in sample_1 by caller_1 and in sample_2
by caller_1 and caller_2. This SV will not be retained.

## How to merge SVs with SURVIVOR

- In order to merge SVs with SURVIVOR and still be able to track each SV and 
  caller for a given sample, you need to rename the sample in the VCF file to be
  <sample>_<caller>. For example, the VCF generated by sniffles for sample01 
  will have the sample name (in the VCF header) changed to sample01_sniffles.
- This will need to be done for each VCF file. GATK has a tool called
  `RenameSampleInVcf` that can be used to do this.
- You will need to have all your VCF files uncompressed as well. If they're not,
  SURVIVOR will still merge them but you will get a whole lot of random binary
  strings and characters in the output file.
- You can then give SURVIVOR a text file with the paths to the VCF files you
  want to merge. This should be one line per VCF file.

- You can then run SURVIVOR merge with the following command:
```bash
survivor merge <vcf_file_list> 50 1 1 0 0 50 <output_file>
```
- Where:
    - `<vcf_file_list>` is the text file with the paths to the VCF files you want
        to merge.
    - `50` is the maximum distance between breakpoints. I.e., SVs further apart
        than this will be treated as separate SVs.
    - `1` is the minimum number of callers that need to call the SV for it to be
        retained. Note, this should be set to `2` as you want to have at least
        two callers supporting the SV. However, I couldn't get it to work as expected
        so I set it to `1` and filtered for two callers later.
    - `1` Take the SV type into account (1 == True). This means that it will not
        merge a INS SV with a DEL SV.
    - `0` Take the SV strand into account (0 == False). 
    - `0` Estimate distance based on the size of the SV (0 == False). I can't
        find any documentation on this but previous papers have used it as `0`.
    - `50` is the minimum size of the SV before it is considered.
    - `<output_file>` is the name of the output file. This will be a VCF file.
  
>**Note:**
> Moving forward, I would suggest only using the `sniffles` and merging SVs with
> `sniffles merge`. This seems to be a lot more sophisticated and robust 
> compared to the somewhat haphazard SURVIVOR merge.